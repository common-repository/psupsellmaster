!function(t){var a;(a={attributes:{},events:{onChartJsScalesXTicksCallback:function a(e,s,n){var l=this.getLabelForValue(e)||"";return t("<textarea/>").html(l).text()},onChartJsScalesAmountTicksCallback:function e(s,n,l){var i=a.data.texts.currency_symbol;return i=t("<textarea/>").html(i).text(),i+=s.toLocaleString()},onChartJsSort:function t(){return -1},onChartJsTooltipLabel:function e(s){var n="";return"earnings"===s.dataset.yAxisID&&(n=a.data.texts.currency_symbol),n=`${s.dataset.label}: ${n}${s.raw}`,n=t("<textarea/>").html(n).text()},onChartJsTooltipTitle:function a(e){var s=(e[0]||{}).label;return t("<textarea/>").html(s).text()},onClickBtnApplyFilters:function t(e){a.functions.applyFilters()},onClickBtnDuplicateCampaign:function e(s){s.preventDefault();var n=t(this).attr("data-campaign-id");a.functions.duplicateCampaigns(Array(n))},onClickBtnResetFilters:function t(e){a.functions.resetFilters()},onClickBtnToggleFilters:function a(){t(this).closest(".psupsellmaster-section").find(".psupsellmaster-filters-toggle").toggle()},onDataTableAjaxData:function e(s,n){return s=t.extend(!0,s,{action:"psupsellmaster_ajax_get_campaign_carts",nonce:PsUpsellmaster.attributes.ajax.nonce,campaign_id:t("#psupsellmaster-campaign-id").val(),filters:a.settings.datatables.custom.main.ajax.data.filters})},onDataTableAjaxDataSrc:function t(a){return a.datatables&&a.datatables.main?(a.draw=a.datatables.main.draw||0,a.recordsTotal=a.datatables.main.total||0,a.recordsFiltered=a.datatables.main.filtered||0,a.datatables.main.data||a.datatables.main):a},onDataTableCreatedCell:function a(e){t(e).addClass("psupsellmaster-datatable-col")},onDataTableCreatedRow:function a(e){t(e).addClass("psupsellmaster-datatable-row")},onDataTableExportFormatBody:function a(e,s,n,l){var i=t("<div>").html(e);i.find(".psupsellmaster-ignore-on-export").remove();var r=i.text();return(r=r.replace(/^\s*\n/gm,"")).trim()},onDataTableInitComplete:function e(s){t(".psupsellmaster-datatable-wrapper .buttons-copy").html('<i class="fa fa-copy"></i>&nbsp;'+a.data.texts.datatable_btn_copy),t(".psupsellmaster-datatable-wrapper .buttons-csv").html('<i class="fa fa-file-csv"></i>&nbsp;'+a.data.texts.datatable_btn_csv),t(".psupsellmaster-datatable-wrapper .buttons-excel").html('<i class="fa fa-file-excel"></i>&nbsp;'+a.data.texts.datatable_btn_excel),t(".psupsellmaster-datatable-wrapper .buttons-print").html('<i class="fa fa-print"></i>&nbsp;'+a.data.texts.datatable_btn_print),t(document).trigger("psupsellmaster-datatable-init-complete")},onDataTableUpdate:function t(e,s,n,l){var i=n;i&&(a.functions.startCharts(i),a.functions.updateKpis(i))},onDocumentReady:function t(){a.functions.startPikadayFields(),a.functions.startDataTables()}},functions:{applyFilters:function t(){var e=a.functions.getFilters();a.settings.datatables.custom.main.ajax.data.filters=e,a.functions.reloadDataTable()},clearFilters:function a(){t(".psupsellmaster-filters .psupsellmaster-field").val(null).trigger("change")},duplicateCampaigns:function a(e){var s={action:"psupsellmaster_ajax_duplicate_campaigns",nonce:PsUpsellmaster.attributes.ajax.nonce,ids:e};t.ajax({type:"post",url:PsUpsellmaster.attributes.ajax.url,data:s,beforeSend:function(t){},success:function(t){t.redirect&&1===e.length&&window.open(t.redirect,"_blank")},error:function(t,a,e){},complete:function(t,a){}})},getFilters:function a(){var e={carts:{date:{start:[],end:[]},gross_earnings:{min:[],max:[]},tax:{min:[],max:[]},discount:{min:[],max:[]},net_earnings:{min:[],max:[]},quantity:{min:[],max:[]},aov:{min:[],max:[]}}},s=t(".psupsellmaster-filters");return e.carts.date.start=s.find(".psupsellmaster-field-carts-date-start").val()||[],e.carts.date.end=s.find(".psupsellmaster-field-carts-date-end").val()||[],e.carts.gross_earnings.min=s.find(".psupsellmaster-field-carts-gross-earnings-min").val()||[],e.carts.gross_earnings.max=s.find(".psupsellmaster-field-carts-gross-earnings-max").val()||[],e.carts.tax.min=s.find(".psupsellmaster-field-carts-tax-min").val()||[],e.carts.tax.max=s.find(".psupsellmaster-field-carts-tax-max").val()||[],e.carts.discount.min=s.find(".psupsellmaster-field-carts-discount-min").val()||[],e.carts.discount.max=s.find(".psupsellmaster-field-carts-discount-max").val()||[],e.carts.net_earnings.min=s.find(".psupsellmaster-field-carts-net-earnings-min").val()||[],e.carts.net_earnings.max=s.find(".psupsellmaster-field-carts-net-earnings-max").val()||[],e.carts.quantity.min=s.find(".psupsellmaster-field-carts-quantity-min").val()||[],e.carts.quantity.max=s.find(".psupsellmaster-field-carts-quantity-max").val()||[],e.carts.aov.min=s.find(".psupsellmaster-field-carts-aov-min").val()||[],e.carts.aov.max=s.find(".psupsellmaster-field-carts-aov-max").val()||[],e},init:function t(){a.functions.registerAttributes(),a.functions.registerEvents()},registerAttributes:function e(){"undefined"!=typeof psupsellmaster_admin_data_campaigns_view&&(a.data=psupsellmaster_admin_data_campaigns_view),a.settings={chartjs:{default:{},custom:{main:{}}},datatables:{default:{},custom:{main:{}}}},a.settings.chartjs.default={data:{datasets:[{backgroundColor:"rgb(24, 128, 56)",borderColor:"rgb(24, 128, 56)",data:[],label:"",order:1,type:"line",yAxisID:"earnings"},{backgroundColor:"rgb(217, 48, 37)",borderColor:"rgb(217, 48, 37)",data:[],label:"",order:3,type:"line",yAxisID:"orders"},{backgroundColor:"rgb(26, 115, 232)",borderColor:"rgb(26, 115, 232)",data:[],label:"",order:2,type:"line",yAxisID:"carts"},],labels:[]},options:{interaction:{intersect:!1,mode:"index"},maintainAspectRatio:!1,plugins:{legend:{labels:{sort:a.events.onChartJsSort}},tooltip:{callbacks:{label:a.events.onChartJsTooltipLabel,title:a.events.onChartJsTooltipTitle},itemSort:a.events.onChartJsSort}},responsive:!0,scales:{x:{ticks:{callback:a.events.onChartJsScalesXTicksCallback}},earnings:{position:"left",ticks:{callback:a.events.onChartJsScalesAmountTicksCallback}},orders:{display:!1,position:"right",ticks:{precision:0}},carts:{position:"right",ticks:{precision:0}}}}},a.settings.chartjs.custom.main=t.extend(!0,{},a.settings.chartjs.default),a.settings.datatables.default={ajax:{data:a.events.onDataTableAjaxData,dataSrc:a.events.onDataTableAjaxDataSrc,type:"POST",url:PsUpsellmaster.attributes.ajax.url},buttons:[{className:"button",extend:"copyHtml5",exportOptions:{format:{body:a.events.onDataTableExportFormatBody}}},{className:"button",extend:"print",exportOptions:{format:{body:a.events.onDataTableExportFormatBody}}},{className:"button",extend:"csvHtml5",exportOptions:{format:{body:a.events.onDataTableExportFormatBody}}},{className:"button",extend:"excelHtml5",exportOptions:{format:{body:a.events.onDataTableExportFormatBody}}},],columnDefs:[{className:"dt-body-left",targets:[0,1,2]},{className:"dt-body-right",targets:[3,4,5,6,7,8,9,10]},{orderable:!1,targets:[]},{createdCell:a.events.onDataTableCreatedCell,targets:"_all"},],createdRow:a.events.onDataTableCreatedRow,displayLength:10,dom:"Bliptip",filter:!0,initComplete:a.events.onDataTableInitComplete,oLanguage:{sLengthMenu:a.data.texts.datatable_length},order:[[8,"desc"]],pageLength:10,lengthMenu:[[10,25,50,100,250,1e3],[10,25,50,100,250,1e3],],paginate:!0,pagingType:"full_numbers",serverSide:!0,responsive:{details:{target:".psupsellmaster-toggle-details",type:"column"}}},a.settings.datatables.custom.main=t.extend(!0,{},a.settings.datatables.default),a.instances={charts:{main:null},datatables:{main:null}}},registerEvents:function e(){t(a.events.onDocumentReady),t(document).on("xhr.dt","#psupsellmaster-datatable-campaign-carts",a.events.onDataTableUpdate),t(document).on("click","#psupsellmaster-btn-toggle-filters",a.events.onClickBtnToggleFilters),t(document).on("click","#psupsellmaster-btn-apply-filters",a.events.onClickBtnApplyFilters),t(document).on("click","#psupsellmaster-btn-reset-filters",a.events.onClickBtnResetFilters),t(document).on("click",".psupsellmaster-btn-duplicate-campaign",a.events.onClickBtnDuplicateCampaign)},reloadDataTable:function t(){a.instances.datatables.main.ajax.reload()},resetFilters:function t(){a.functions.clearFilters(),a.settings.datatables.custom.main.ajax.data.filters={},a.functions.reloadDataTable()},startCharts:function t(e){if(a.instances.charts.main)try{a.instances.charts.main.destroy()}catch(s){}var n=0;a.settings.chartjs.custom.main.data.datasets[0].data=[],a.settings.chartjs.custom.main.data.labels=[],n=e.charts.main.items.length;for(var l=0;l<n;l++)a.settings.chartjs.custom.main.data.datasets[0].data.push(e.charts.main.items[l].earnings),a.settings.chartjs.custom.main.data.datasets[1].data.push(e.charts.main.items[l].carts),a.settings.chartjs.custom.main.data.datasets[2].data.push(e.charts.main.items[l].orders),a.settings.chartjs.custom.main.data.labels.push(e.charts.main.items[l].label);n=e.charts.main.legends.length;for(var l=0;l<n;l++)a.settings.chartjs.custom.main.data.datasets[0].label=e.charts.main.legends[l].earnings,a.settings.chartjs.custom.main.data.datasets[1].label=e.charts.main.legends[l].carts,a.settings.chartjs.custom.main.data.datasets[2].label=e.charts.main.legends[l].orders;a.instances.charts.main=new Chart(document.getElementById("psupsellmaster-campaign-chart-main"),a.settings.chartjs.custom.main)},startDataTables:function e(){a.instances.datatables.main=t("#psupsellmaster-datatable-campaign-carts").DataTable(a.settings.datatables.custom.main)},startPikadayFields:function e(){t(".psupsellmaster-field-pikaday").each(function(){var e;e=t(this),a.functions.startPikadayField(e)})},startPikadayField:function t(a){var e;e={field:a.get(0),format:"YYYY/MM/DD"},new Pikaday(e)},updateKpis:function a(e){t(".psupsellmaster-kpis").html(e.kpis)}}}).functions.init()}(jQuery);