!function(e){var t;(t={attributes:{},events:{onClickBtnDeleteTemplate:function a(n){if(n.preventDefault(),!confirm(t.data.texts.delete_item_confirm))return!1;var s=e(this),l=s.closest(".psupsellmaster-modal"),i=l.find(".psupsellmaster-modal-ajax-container"),o=l.find(".psupsellmaster-modal-loader"),p=s.attr("data-template");i.html(""),o.show();var m={action:"psupsellmaster_ajax_delete_campaign_templates",nonce:PsUpsellmaster.attributes.ajax.nonce,ids:Array(p)};e.ajax({type:"post",url:PsUpsellmaster.attributes.ajax.url,data:m,beforeSend:function(e){},success:function(e){},error:function(e,t,a){},complete:function(e,a){t.functions.loadCampaignTemplates()}})},onClickBtnNewBlankCampaign:function t(a){var n=e(this).closest(".psupsellmaster-modal");PsUpsellmaster.functions.closeModal(n)},onClickBtnNewCampaign:function e(a){a.preventDefault(),t.functions.openModalNewCampaign()},onClickBtnNewCampaignFromTemplate:function t(a){a.preventDefault();var n=e(this),s=n.closest(".psupsellmaster-modal"),l=s.find(".psupsellmaster-modal-ajax-container"),i=s.find(".psupsellmaster-modal-loader"),o=n.attr("data-template");l.html(""),i.show();var p={action:"psupsellmaster_ajax_create_campaign_from_template",nonce:PsUpsellmaster.attributes.ajax.nonce,template:o};e.ajax({type:"post",url:PsUpsellmaster.attributes.ajax.url,data:p,beforeSend:function(e){},success:function(e){e.html?l.html(e.html):e.redirect&&(window.open(e.redirect,"_blank"),PsUpsellmaster.functions.closeModal(s))},error:function(e,t,a){},complete:function(e,t){i.hide()}})},onClickBtnSaveAsTemplate:function t(a){a.preventDefault();var n=e(this),s=e("#psupsellmaster-modal-save-template"),l=s.find(".psupsellmaster-modal-fields"),i=s.find(".psupsellmaster-modal-ajax-container"),o=n.attr("data-campaign-id"),p=s.find(".psupsellmaster-field-campaign-id"),m=s.find(".psupsellmaster-field-template-title"),r=s.find(".psupsellmaster-btn-save-as-template-confirm");p.val(o),m.val(""),r.prop("disabled",!1),i.hide(),l.show(),PsUpsellmaster.functions.openModal(s),m.trigger("focus")},onSubmitFormSaveTemplate:function t(a){a.preventDefault();var n=e("#psupsellmaster-modal-save-template"),s=n.find(".psupsellmaster-modal-fields"),l=n.find(".psupsellmaster-modal-ajax-container"),i=n.find(".psupsellmaster-modal-loader"),o=n.find(".psupsellmaster-btn-save-as-template-confirm"),p=n.find(".psupsellmaster-field-campaign-id").val(),m=n.find(".psupsellmaster-field-template-title").val();o.prop("disabled",!0),s.hide(),i.show();var r={action:"psupsellmaster_ajax_save_campaign_as_template",nonce:PsUpsellmaster.attributes.ajax.nonce,id:p,title:m};e.ajax({type:"post",url:PsUpsellmaster.attributes.ajax.url,data:r,beforeSend:function(e){},success:function(e){},error:function(e,t,a){},complete:function(e,t){i.hide(),e.responseJSON&&e.responseJSON.html&&(l.html(e.responseJSON.html),l.show()),setTimeout(function(){PsUpsellmaster.functions.closeModal(n)},1500)}})}},functions:{init:function e(){t.functions.registerAttributes(),t.functions.registerEvents()},loadCampaignTemplates:function t(){var a=e("#psupsellmaster-modal-new-campaign").find(".psupsellmaster-modal-body"),n=a.find(".psupsellmaster-modal-loader"),s=a.find(".psupsellmaster-modal-ajax-container");s.html(""),n.show();var l={};l.action="psupsellmaster_ajax_get_campaign_templates",l.nonce=PsUpsellmaster.attributes.ajax.nonce,PsUpsellmaster.attributes.popups.lock=!0,e.ajax({url:PsUpsellmaster.attributes.ajax.url,type:"post",dataType:"json",data:l}).done(function(e){e.templates&&0!==e.templates.length&&s.html(e.templates)}).always(function(){PsUpsellmaster.attributes.popups.lock=!1,n.hide()})},openModalNewCampaign:function a(){if(!0===PsUpsellmaster.attributes.popups.lock)return!1;var n=e("#psupsellmaster-modal-new-campaign");t.functions.loadCampaignTemplates(),PsUpsellmaster.functions.openModal(n)},registerAttributes:function e(){"undefined"!=typeof psupsellmaster_admin_data_campaigns_templates&&(t.data=psupsellmaster_admin_data_campaigns_templates)},registerEvents:function a(){e(document).on("click",".psupsellmaster-btn-delete-template",t.events.onClickBtnDeleteTemplate),e(document).on("click",".psupsellmaster-btn-new-blank-campaign",t.events.onClickBtnNewBlankCampaign),e(document).on("click",".psupsellmaster-btn-new-campaign",t.events.onClickBtnNewCampaign),e(document).on("click",".psupsellmaster-btn-new-campaign-from-template",t.events.onClickBtnNewCampaignFromTemplate),e(document).on("click",".psupsellmaster-btn-save-as-template",t.events.onClickBtnSaveAsTemplate),e(document).on("submit","#psupsellmaster-modal-save-template",t.events.onSubmitFormSaveTemplate)}}}).functions.init()}(jQuery);