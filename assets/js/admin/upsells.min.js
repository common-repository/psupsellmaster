!function(t){var a;(a={attributes:{},events:{onClickBtnApplyBulkAction:function e(s){var l=[],n=t(".psupsellmaster_products_select_product:checked");if(n.each(function(){l.push(t(this).attr("data-id"))}),0===l.length){alert(psupsellmaster_admin_data_upsells.texts.msg_err_products_not_selected);return}var r=t(".psupsellmaster_bulk_action").val();if(0===r.length){alert(psupsellmaster_admin_data_upsells.texts.msg_err_operation_not_selected);return}if(["disable","enable","recalc"].includes(r)){if("recalc"===r){if(!confirm(psupsellmaster_admin_data_upsells.texts.msg_confirm_recalculate_selected))return;PsUpsellmasterAdminScores.functions.startBackgroundProcess({products:l})}else a.functions.setScoresStatus({products:l,status:"disable"===r?"disabled":"enabled"});n.each(function(){t(this).removeAttr("checked")})}},onClickBtnResetDateFilters:function a(e){t("#psupsellmaster_date_from").val("").trigger("change"),t("#psupsellmaster_date_to").val("").trigger("change")},onClickBtnResetFilters:function a(e){PsUpsellmaster.select2.functions.clearAll(),t("#psupsellmaster_btn_reset").trigger("click"),t("#psupsellmaster_products_table").DataTable().ajax.url(PsUpsellmaster.attributes.ajax.url+"?nonce="+PsUpsellmaster.attributes.ajax.nonce+"&action=psupsellmaster_admin_ajax_get_base_products").load(),t("#psupsellmaster_search").val("").trigger("search")},onClickToggleProductStatus:function e(s){s.preventDefault();var l=t(this);t.post(PsUpsellmaster.attributes.ajax.url,{action:"psupsellmaster_scores_set_status",nonce:PsUpsellmaster.attributes.ajax.nonce,products:Array(l.attr("data-id")),status:"disable"===l.attr("data-status")?"disabled":"enabled"},function(t){"OK"===t.status?a.instances.datatables.main.ajax.reload():alert(t.msg)})},onDataTableAjaxData:function a(e,s){return e=t.extend(!0,e,{nonce:PsUpsellmaster.attributes.ajax.nonce})},onDataTableAjaxDataSrc:function t(a){return a.datatable?(a.draw=a.datatable.draw||0,a.recordsTotal=a.datatable.total||0,a.recordsFiltered=a.datatable.filtered||0,a.datatable.data||a.datatable):a},onDataTableButtonsAction:function a(e,s,l,n){var r=t(e.target);if(r.hasClass("psupsellmaster-btn-recalculate")){if(!confirm(psupsellmaster_admin_data_upsells.texts.msg_confirm_recalculate_all))return;PsUpsellmasterAdminScores.functions.startBackgroundProcess(),r.prop("disabled",!0).addClass("disabled")}else r.hasClass("psupsellmaster-btn-abort")&&(PsUpsellmasterAdminScores.functions.stopBackgroundProcess(),r.prop("disabled",!0).addClass("disabled"))},onDataTableCreatedCell:function a(e){t(e).addClass("psupsellmaster-datatable-col")},onDataTableCreatedRow:function a(e){t(e).addClass("psupsellmaster-datatable-row")},onDataTableInitComplete:function e(s){t(".psupsellmaster-datatable-wrapper .psupsellmaster-btn-abort").html('<i class="fa fa-times "></i>&nbsp;'+a.data.texts.datatable_btn_abort),t(".psupsellmaster-datatable-wrapper .psupsellmaster-btn-recalculate").html('<i class="fa fa-calculator "></i>&nbsp;'+a.data.texts.datatable_btn_recalculate),t(".psupsellmaster-datatable-wrapper .buttons-copy").html('<i class="fa fa-copy"></i>&nbsp;'+a.data.texts.datatable_btn_copy),t(".psupsellmaster-datatable-wrapper .buttons-csv").html('<i class="fa fa-file-csv"></i>&nbsp;'+a.data.texts.datatable_btn_csv),t(".psupsellmaster-datatable-wrapper .buttons-excel").html('<i class="fa fa-file-excel"></i>&nbsp;'+a.data.texts.datatable_btn_excel),t(".psupsellmaster-datatable-wrapper .buttons-print").html('<i class="fa fa-print"></i>&nbsp;'+a.data.texts.datatable_btn_print),t("#psupsellmaster_bulk_container").detach().prependTo("#psupsellmaster_upsells_wrapper .dt-buttons"),t("#psupsellmaster_bulk_container").show(),t(document).trigger("psupsellmaster-datatable-init-complete"),t(document).off("psupsellmaster-datatable-init-complete",a.events.onFirstDataTableInitComplete)},onDataTableUpdate:function t(e,s,l,n){var r,o;(o=l)&&(r=o.dates.bp_last_run,a.functions.refreshLastRunDate(r))},onDocumentReady:function e(){t(".psupsellmaster_date").each(function(){t(this),new Pikaday({field:t(this).get(0),format:"YYYY/MM/DD"})}),t("#psupsellmaster_btn_this_month").on("click",function(){let a=moment().startOf("month").format("YYYY/MM/DD"),e=moment().endOf("month").format("YYYY/MM/DD");t("#psupsellmaster_date_from").val(a).trigger("change"),t("#psupsellmaster_date_to").val(e).trigger("change")}),t("#psupsellmaster_btn_last_month").on("click",function(){let a=moment().subtract(1,"months").startOf("month").format("YYYY/MM/DD"),e=moment().subtract(1,"months").endOf("month").format("YYYY/MM/DD");t("#psupsellmaster_date_from").val(a).trigger("change"),t("#psupsellmaster_date_to").val(e).trigger("change")}),t("#psupsellmaster_btn_this_year").on("click",function(){let a=moment().startOf("year").format("YYYY/MM/DD"),e=moment().endOf("year").format("YYYY/MM/DD");t("#psupsellmaster_date_from").val(a).trigger("change"),t("#psupsellmaster_date_to").val(e).trigger("change")}),t("#psupsellmaster_btn_last_year").on("click",function(){let a=moment().subtract(1,"years").startOf("year").format("YYYY/MM/DD"),e=moment().subtract(1,"years").endOf("year").format("YYYY/MM/DD");t("#psupsellmaster_date_from").val(a).trigger("change"),t("#psupsellmaster_date_to").val(e).trigger("change")}),t("#psupsellmaster_btn_last_week").on("click",function(){let a=moment().subtract(1,"week").startOf("week").format("YYYY/MM/DD"),e=moment().subtract(1,"week").endOf("week").format("YYYY/MM/DD");t("#psupsellmaster_date_from").val(a).trigger("change"),t("#psupsellmaster_date_to").val(e).trigger("change")}),t("#psupsellmaster_btn_apply_filters").on("click",function(){s=(e=t(this)).closest("#psupsellmaster_filters"),l={},s.find(".psupsellmaster-field-custom-taxonomy").each(function(){var a,e,s;s=(a=t(this)).val(),l[e=a.data("taxonomy")]=s});var e,s,l,n={cat:t("#psupsellmaster_categories").val(),tag:t("#psupsellmaster_tags").val(),dtf:(""+t("#psupsellmaster_date_from").val()).replace(/\//g,"-"),dtt:(""+t("#psupsellmaster_date_to").val()).replace(/\//g,"-"),custom_taxonomies:l},r=PsUpsellmaster.attributes.ajax.url+"?nonce="+PsUpsellmaster.attributes.ajax.nonce+"&action=psupsellmaster_admin_ajax_get_base_products&f="+encodeURIComponent(JSON.stringify(n));a.instances.datatables.main.ajax.url(r).load()}),t(".psupsellmaster_select_all_products").on("click",function(a){t(".psupsellmaster_products_select_product").trigger("click")}),a.functions.startDataTables(),PsUpsellmasterAdminScores.functions.getBackgroundProcessStatus()},onFirstDataTableInitComplete:function t(){},onGetBpScoresStatus:function e(s,l){var n=t("#psupsellmaster_upsells_wrapper").find(".dt-buttons");"none"===l.status?(n.find(".psupsellmaster-btn-abort").prop("disabled",!0).addClass("disabled").hide(),n.find(".psupsellmaster-btn-recalculate").prop("disabled",!1).removeClass("disabled").show(),["done","stopping"].includes(a.bps.scores.status)&&a.functions.reloadDataTable()):"running"===l.status&&(n.find(".psupsellmaster-btn-recalculate").prop("disabled",!0).addClass("disabled").hide(),n.find(".psupsellmaster-btn-abort").prop("disabled",!1).removeClass("disabled").show()),a.bps.scores.status=l.status}},functions:{init:function t(){a.functions.registerAttributes(),a.functions.registerEvents()},registerAttributes:function t(){"undefined"!=typeof psupsellmaster_admin_data_upsells&&(a.data=psupsellmaster_admin_data_upsells),a.settings={datatables:{main:{}}},a.settings.datatables.main={ajax:{data:a.events.onDataTableAjaxData,dataSrc:a.events.onDataTableAjaxDataSrc,type:"POST",url:PsUpsellmaster.attributes.ajax.url+"?nonce="+PsUpsellmaster.attributes.ajax.nonce+"&action=psupsellmaster_admin_ajax_get_base_products"},buttons:[{className:"button button-primary psupsellmaster-btn-recalculate disabled",action:a.events.onDataTableButtonsAction},{className:"button psupsellmaster-btn-abort disabled",action:a.events.onDataTableButtonsAction},{className:"button",extend:"copyHtml5"},{className:"button",extend:"print"},{className:"button",extend:"csvHtml5"},{className:"button",extend:"excelHtml5"},],columnDefs:[{className:"dt-body-center",targets:[0,2]},{className:"dt-body-left",targets:[1,3,4],width:"25%"},{className:"dt-body-right",targets:5},{orderable:!1,targets:[0,3,4]},{createdCell:a.events.onDataTableCreatedCell,targets:"_all"},],createdRow:a.events.onDataTableCreatedRow,displayLength:10,dom:"Bfliptip",filter:!0,initComplete:a.events.onDataTableInitComplete,oLanguage:{sLengthMenu:a.data.texts.datatable_length},order:[[1,"asc"]],pageLength:10,lengthMenu:[[10,25,50,100,250,1e3],[10,25,50,100,250,1e3],],paginate:!0,pagingType:"full_numbers",serverSide:!0},a.instances={datatables:{main:null}},a.bps={scores:{status:null}}},registerEvents:function e(){t(a.events.onDocumentReady),t(document).on("psupsellmaster-datatable-init-complete",a.events.onFirstDataTableInitComplete),t(document).on("xhr.dt","#psupsellmaster_products_table",a.events.onDataTableUpdate),t(document).on("psupsellmaster-get-bp-scores-status",a.events.onGetBpScoresStatus),t(document).on("click","#psupsellmaster_btn_reset_filters",a.events.onClickBtnResetFilters),t(document).on("click","#psupsellmaster_btn_reset",a.events.onClickBtnResetDateFilters),t(document).on("click",".psupsellmaster_enable",a.events.onClickToggleProductStatus),t(document).on("click",".psupsellmaster-btn-apply-bulk-action",a.events.onClickBtnApplyBulkAction)},refreshLastRunDate:function a(e){var s;(s=t(".psupsellmaster-bp-last-run-date")).html(e)},reloadDataTable:function t(){a.instances.datatables.main.ajax.reload()},setScoresStatus:function e(s={}){var l={action:"psupsellmaster_scores_set_status",nonce:PsUpsellmaster.attributes.ajax.nonce};s.products&&(l.products=s.products),s.status&&(l.status=s.status);var n=t("#psupsellmaster_upsells_wrapper .dt-button");n.attr("disabled","disabled"),t.post(PsUpsellmaster.attributes.ajax.url,l,function(t){n.removeAttr("disabled","disabled"),a.instances.datatables.main.ajax.reload()})},startDataTables:function e(){a.instances.datatables.main=t("#psupsellmaster_products_table").DataTable(a.settings.datatables.main)}}}).functions.init()}(jQuery);