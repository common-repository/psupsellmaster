!function(e){var s;(s={attributes:{},events:{onChangeCheckableField:function t(a){var l=e(this),n=l.closest(".psupsellmaster-item").closest(".psupsellmaster-list"),o=l.closest(".psupsellmaster-modal-form");if(l.is(".psupsellmaster-checkbox, .psupsellmaster-radio")){var i=o.find(l.attr("data-toggle-target"));if(l.is(":checked")){var r=n.children(".psupsellmaster-item");if(l.is(".psupsellmaster-checkbox")){if(l.hasClass("psupsellmaster-exclusive")){var u=r.find(".psupsellmaster-checkbox");u.not(l).each(function(){var s=e(this);s.closest(".psupsellmaster-list").is(n)&&s.prop("checked",!1)})}else{var u=r.find(".psupsellmaster-checkbox.psupsellmaster-exclusive");u.each(function(){var s=e(this);s.closest(".psupsellmaster-list").is(n)&&s.prop("checked",!1)})}}else o.find('[name="'+l.attr("name")+'"]').each(function(){var s=e(this);o.find(s.attr("data-toggle-target")).hide()});i.css("display",i.attr("data-display")),o.find(l.attr("data-focus-target")).first().focus()}else i.hide();"invalid"===s.functions.getFormStatus()&&s.functions.validateForm()}},onClickButtonDeactivate:function s(t){if(e(this).closest("tr").attr("data-plugin").includes("/psupsellmaster.php")){var a=e("#psupsellmaster-modal-feedback");0!==a.length&&(t.preventDefault(),PsUpsellmasterAdminModal.functions.openModal(a))}},onClickButtonSkip:function e(t){t.preventDefault(),s.functions.showBackdropSpinner(),s.functions.deactivate()},onClickButtonSubmit:function t(a){if(a.preventDefault(),s.functions.maybeStartForm(),"invalid"===s.functions.validateForm())return!1;var l=e("#psupsellmaster-modal-feedback").find(".psupsellmaster-modal-form"),n={nonce:PsUpsellmaster.attributes.ajax.nonce,action:"psupsellmaster_ajax_handle_feedback",form:l.serialize()};s.functions.showBackdropSpinner(),e.ajax({url:PsUpsellmaster.attributes.ajax.url,type:"POST",dataType:"JSON",data:n,complete:function(e,t){s.functions.deactivate()}})},onCloseModal:function e(t){s.functions.resetForm(),s.functions.maybeSwitchPrimaryButton()},onInputNonZeroFloatAmount:function s(t){var a=e(t.target),l=a.val();l=(l=parseFloat(l)||"").toString(),a.val(l)},onInputNonZeroIntegerAmount:function s(t){var a=e(t.target),l=a.val();l=(l=parseInt(l)||"").toString(),a.val(l)},onInputTextField:function e(t){s.functions.maybeStartForm(),"invalid"===s.functions.getFormStatus()&&s.functions.validateForm()}},functions:{deactivate:function s(){var t=e('#the-list tr.active[data-plugin*="/psupsellmaster.php"] .row-actions .deactivate a').attr("href");t&&(window.location=t)},getFormStatus:function s(){return e("#psupsellmaster-modal-feedback").find(".psupsellmaster-modal-form").attr("data-status")},init:function e(){s.functions.registerEvents()},maybeStartForm:function e(){s.functions.getFormStatus()||(s.functions.setFormStatus("started"),s.functions.maybeSwitchPrimaryButton())},maybeSwitchPrimaryButton:function t(){var a=e("#psupsellmaster-modal-feedback").find(".psupsellmaster-modal-form"),l=a.find(".psupsellmaster-button-cancel"),n=a.find(".psupsellmaster-button-submit");s.functions.getFormStatus()?(l.addClass("button-secondary"),l.removeClass("button-primary"),n.addClass("button-primary"),n.removeClass("button-secondary")):(l.addClass("button-primary"),l.removeClass("button-secondary"),n.addClass("button-secondary"),n.removeClass("button-primary"))},registerEvents:function t(){e(document).on("change","#psupsellmaster-modal-feedback .psupsellmaster-field.psupsellmaster-checkable",s.events.onChangeCheckableField),e(document).on("click",'#the-list .row-actions [id^="deactivate-"]',s.events.onClickButtonDeactivate),e(document).on("click","#psupsellmaster-modal-feedback .psupsellmaster-button-skip",s.events.onClickButtonSkip),e(document).on("input","#psupsellmaster-modal-feedback .psupsellmaster-field.psupsellmaster-text",s.events.onInputTextField),e(document).on("input","#psupsellmaster-modal-feedback .psusellmaster-non-zero-float",s.events.onInputNonZeroFloatAmount),e(document).on("input","#psupsellmaster-modal-feedback .psusellmaster-non-zero-integer",s.events.onInputNonZeroIntegerAmount),e(document).on("submit","#psupsellmaster-modal-feedback .psupsellmaster-modal-form",s.events.onClickButtonSubmit),e(document).on("after-close.psupsellmaster.modal","#psupsellmaster-modal-feedback",s.events.onCloseModal)},resetForm:function s(t){var a=e("#psupsellmaster-modal-feedback");a.find(".psupsellmaster-modal-form").removeAttr("data-status"),a.find(".psupsellmaster-section").removeClass("psupsellmaster-invalid"),a.find(".psupsellmaster-form-input").removeClass("psupsellmaster-invalid"),a.find(".psupsellmaster-hidden").hide(),a.find(".psupsellmaster-checkbox, .psupsellmaster-radio").prop("checked",!1),a.find(".psupsellmaster-field:not(.psupsellmaster-checkbox, .psupsellmaster-radio)").val("")},setFormStatus:function s(t){e("#psupsellmaster-modal-feedback").find(".psupsellmaster-modal-form").attr("data-status",t)},showBackdropSpinner:function s(){e("#psupsellmaster-modal-feedback").find(".psupsellmaster-backdrop-spinner").show()},validateForm:function t(){var a="submitted";return e("#psupsellmaster-modal-feedback").find(".psupsellmaster-modal-form").find(".psupsellmaster-section").each(function(){var s=e(this),t="valid";s.find(".psupsellmaster-field").each(function(){var a=e(this),l="valid";a.hasClass("psupsellmaster-required")&&a.is(":visible")&&((l="invalid",a.hasClass("psupsellmaster-text"))?a.val()&&(l="valid"):(a.hasClass("psupsellmaster-checkbox")||a.hasClass("psupsellmaster-radio"))&&(a.is(":checked")?l="valid":s.find('[name="'+a.attr("name")+'"]').is(":checked")&&(l="valid")));var n=a.closest(".psupsellmaster-form-input");"valid"===l?n.removeClass("psupsellmaster-invalid"):(n.addClass("psupsellmaster-invalid"),t="invalid")}),"valid"===t?s.removeClass("psupsellmaster-invalid"):(s.addClass("psupsellmaster-invalid"),a="invalid")}),s.functions.setFormStatus(a),a}}}).functions.init()}(jQuery);